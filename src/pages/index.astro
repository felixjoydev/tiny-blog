---
import Layout from "../layouts/Layout.astro";
import { createSupabaseServerClient } from "../lib/supabaseServer";
import felixLogo from "../assets/icons/felix-logo.svg";

export const prerender = false;

const supabase = createSupabaseServerClient(Astro.cookies);
const {
  data: { session },
} = await supabase.auth.getSession();

// If logged in, redirect to their profile page
if (session?.user) {
  // Fetch user's handle
  const { data: profile } = await supabase
    .from("profiles")
    .select("handle")
    .eq("id", session.user.id)
    .single();

  if (profile?.handle) {
    return Astro.redirect(`/u/${profile.handle}`);
  }
  // Fallback to UUID route if no handle
  return Astro.redirect(`/profile/${session.user.id}`);
}
---

<Layout title="Home - Tiny Blog">
  <div class="max-w-125 mx-auto px-4 py-12 flex justify-center">
    <div
      class="w-[31.25rem] h-auto rounded-[1.875rem] bg-[#FFF1D5] p-8"
      style="box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.08), 0 4px 4px 0 rgba(128, 128, 128, 0.08), 0 2px 2px 0 rgba(128, 128, 128, 0.08), 0 1px 1px 0 rgba(128, 128, 128, 0.08);"
    >
      <div class="space-y-6">
        <h1
          class="font-['Exposure[-40]:Regular',sans-serif] text-[#3f331c] text-5xl"
        >
          Hi Mark,
        </h1>
        <p
          class="font-['Exposure[-20]:Regular',sans-serif] text-[#786237] text-xl"
        >
          Welcome to Tiny.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          This project started as a straightforward assignment, but somewhere
          along the way it turned into something I genuinely cared about. When I
          began building it, I thought I was simply meeting the brief, create a
          small blogging experience with the required features. But as the app
          took shape, I fell in love with the idea of a "tiny blog", a simple
          place where people can share honest thoughts without the pressure of
          building a full online presence.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          That shift changed how I worked. I started putting extra care into the
          details, refining flows, improving the experience, and building beyond
          what was required in the brief, not to overcomplicate it, but because
          it started feeling like a real product that could exist outside the
          classroom.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          I'm planning to launch this publicly in the coming weeks. There are
          still a few styling tweaks, UX improvements and smooth interaction I
          want to make, and I also have more features planned. It's not perfect
          yet, and it's not fully where I envisioned it would be, but it's
          moving in that direction and I'm committed to getting it there.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          For the assignment checkpoint, here is the link to my profile:
          <a
            href="https://tiny-post.netlify.app/u/felixjoy"
            class="text-[#DA5700] underline">tiny.app/u/felixjoy</a
          >. You can comment on my post there (as required in the brief).
          Everything else can be explored by logging in and using the platform
          normally.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          Thank you for the guidance and structure that pushed me to build
          something I now want to take seriously beyond this module.
        </p>
        <p class="type-body-lg text-[#3F331C]">
          <span class="text-[#786237]">Best,</span><br />
          Felix Joy
        </p>
        <a
          href="https://felixjoy.me"
          target="_blank"
          rel="noopener noreferrer"
          class="block w-fit"
        >
          <img src={felixLogo.src} alt="Felix Joy Logo" class="h-8 w-auto" />
        </a>
      </div>
    </div>
  </div>
</Layout>
